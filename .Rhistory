theme(axis.text.y = element_blank()) +
theme(axis.ticks.y = element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
maiores.plt
maiores.plt <- ggplot(maiores.df.plot, aes(media, tipo, fill=tipo))
maiores.plt <- maiores.plt + geom_bar(stat="identity") +
labs(title=" Média das maiores despesas, por tipo",
y="", x="") +
geom_text(aes(label=tipo),
vjust=.5, hjust=1.1, colour="white") +
scale_x_continuous(labels = real) +
scale_colour_manual(values = getPalette(colourCount))+
theme(legend.position="none") +
theme(legend.title=element_blank()) +
theme(axis.text.y = element_blank()) +
theme(axis.ticks.y = element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
maiores.plt
maiores.plt <- ggplot(maiores.df.plot, aes(x=media, y=tipo, fill=tipo))
maiores.plt <- maiores.plt + geom_bar(stat="identity") +
labs(title=" Média das maiores despesas, por tipo",
y="", x="") +
geom_text(aes(label=tipo),
vjust=.5, hjust=1.1, colour="white") +
scale_x_continuous(labels = real) +
scale_colour_manual(values = getPalette(colourCount))+
theme(legend.position="none") +
theme(legend.title=element_blank()) +
theme(axis.text.y = element_blank()) +
theme(axis.ticks.y = element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
maiores.plt
maiores.plt <- ggplot(maiores.df.plot, aes(tipo, media, fill=tipo))
maiores.plt <- maiores.plt + geom_bar(stat="identity") +
labs(title=" Média das maiores despesas, por tipo",
y="", x="") +
geom_text(aes(label=tipo),
vjust=.5, hjust=1.1, colour="white") +
scale_y_continuous(labels = real) +
scale_colour_manual(values = getPalette(colourCount))+
theme(legend.position="none") +
theme(legend.title=element_blank()) +
theme(axis.text.y = element_blank()) +
theme(axis.ticks.y = element_blank()) +
theme(plot.title = element_text(hjust = 0.5)) +
coord_flip()
maiores.plt
p <- plot_ly(maiores.df.plot, x = ~tipo, y = ~media, type = 'bar',
orientation = 'h')
p
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h')
p
?plot_ly()
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo)
p
ax <- list(
title = "",
zeroline = FALSE,
showline = FALSE,
showticklabels = FALSE,
showgrid = FALSE
)
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo) %>%
layout(xaxis = ax, yaxis = ax)
p
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo) %>%
layout(yaxis = ax)
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo) %>%
layout(yaxis = ax)
p
ax <- list(
title = "",
# zeroline = FALSE,
# showline = FALSE,
# showticklabels = FALSE,
# showgrid = FALSE
)
ax <- list(
title = ""
# zeroline = FALSE,
# showline = FALSE,
# showticklabels = FALSE,
# showgrid = FALSE
)
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo) %>%
layout(yaxis = ax)
p
ax <- list(
# title = ""
# zeroline = FALSE,
# showline = FALSE,
showticklabels = FALSE
# showgrid = FALSE
)
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo) %>%
layout(yaxis = ax)
p
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo) %>%
layout(yaxis = ax) %>% add_markers()
p
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo) %>%
layout(yaxis = ax)
p
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo,
text = real(media)) %>%
layout(yaxis = ax)
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo,
text = real(~media)) %>%
layout(yaxis = ax)
real <- dollar_format(prefix = "R$ ")
maiores.plt
ax <- list(
# title = ""
# zeroline = FALSE,
# showline = FALSE,
showticklabels = FALSE
# showgrid = FALSE
)
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo,
text = real(~media)) %>%
layout(yaxis = ax)
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo,
text = ~real(media)) %>%
layout(yaxis = ax)
p
p <- plot_ly(maiores.df.plot, x = ~media, y = ~tipo, type = 'bar',
orientation = 'h', color=~tipo, hoverinfo = "text",
text = ~paste(tipo, ":", real(media))) %>%
layout(yaxis = ax)
p
maiores.plt
p
totais.alim <- totais[totais$tipo=="alimentação",]
medias.alim <- totais.alim %>% group_by(ano) %>%
summarise(media = mean(total))
library(knitr)
opts_chunk$set(echo = FALSE, message = FALSE, include = TRUE,
warning = FALSE, autodep = TRUE, options(scipen=999))
library(scales)
library(stringr)
library(data.table)
library(readxl)
# library(chron)
library(dplyr)
library(lubridate)
library(ggplot2)
library(rmarkdown)
library(RColorBrewer)
library(gridExtra)
library(grid)
library(plotly)
medias.alim <- totais.alim %>% group_by(ano) %>%
summarise(media = mean(total))
medias.alim$media <- round(medias.alim$media, 2)
plt.alim <- ggplot(totais.alim, aes(x=mes, y=total, group=ano, colour=ano))
plt.alim <- plt.alim +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.alim,
aes(yintercept = media, colour = ano), linetype=2) +
geom_label(data = medias.alim, vjust = -0.2, hjust = 1,
aes(12, y = media,label=media)) +
labs(title="Gastos com alimentação", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.alim)
real <- dollar_format(prefix = "R$ ")
plt.alim <- ggplot(totais.alim, aes(x=mes, y=total, group=ano, colour=ano,
text = paste(ano, "-", mes,
"<br>", real(total))))
plt.alim <- plt.alim +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.alim,
aes(yintercept = media, colour = ano), linetype=2) +
geom_label(data = medias.alim, vjust = -0.2, hjust = 1,
aes(12, y = media,label=media)) +
labs(title="Gastos com alimentação", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.alim, tooltip = "text")
View(totais.alim)
plt.alim <- ggplot(totais.alim, aes(x=mes, y=total, group=ano, colour=ano,
text = paste(ano, "-", mes,
"<br>", real(total))))
plt.alim <- plt.alim +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.alim,
aes(yintercept = media, colour = ano), linetype=2) +
geom_label(data = medias.alim, vjust = -0.2, hjust = 1,
aes(12, y = media,label=media)) +
labs(title="Gastos com alimentação", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.alim, tooltip = "text")
plt.alim <- ggplot(totais.alim, aes(x=mes, y=total, group=ano, colour=ano,
text = paste(ano, "-",
"<br>", real(total))))
plt.alim <- plt.alim +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.alim,
aes(yintercept = media, colour = ano), linetype=2) +
geom_label(data = medias.alim, vjust = -0.2, hjust = 1,
aes(12, y = media,label=media)) +
labs(title="Gastos com alimentação", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.alim, tooltip = "text")
plt.alim <- ggplot(totais.alim, aes(x=mes, y=total, group=ano, colour=ano))
plt.alim <- plt.alim +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.alim,
aes(yintercept = media, colour = ano), linetype=2) +
geom_label(data = medias.alim, vjust = -0.2, hjust = 1,
aes(12, y = media,label=media)) +
labs(title="Gastos com alimentação", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.alim)
plt.alim <- ggplot(totais.alim, aes(x=mes, y=total, group=ano, colour=ano))
plt.alim <- plt.alim +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.alim,
aes(yintercept = media, colour = ano), linetype=2) +
# geom_label(data = medias.alim, vjust = -0.2, hjust = 1,
#           aes(12, y = media,label=media)) +
labs(title="Gastos com alimentação", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.alim)
plt.alim <- ggplot(totais.alim, aes(x=mes, y=total, group=ano, colour=ano,
text = paste(ano, "-", mes,
"<br>", real(total))))
plt.alim <- plt.alim +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.alim,
aes(yintercept = media, colour = ano), linetype=2) +
# geom_label(data = medias.alim, vjust = -0.2, hjust = 1,
#           aes(12, y = media,label=media)) +
labs(title="Gastos com alimentação", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.alim)
ggplotly(plt.alim, tooltip = "text")
plt.alim <- ggplot(totais.alim, aes(x=mes, y=total, group=ano, colour=ano,
text = paste(ano, "-", mes,
"<br>", real(total))))
plt.alim <- plt.alim +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.alim,
aes(yintercept = media, colour = ano), linetype=2,
text=paste(real(media))) +
# geom_label(data = medias.alim, vjust = -0.2, hjust = 1,
#           aes(12, y = media,label=media)) +
labs(title="Gastos com alimentação", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
plt.alim <- plt.alim +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.alim,
aes(yintercept = media, colour = ano,
text=paste(real(media))),
linetype=2) +
# geom_label(data = medias.alim, vjust = -0.2, hjust = 1,
#           aes(12, y = media,label=media)) +
labs(title="Gastos com alimentação", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.alim, tooltip = "text")
plt.pag <- ggplot(totais.pag, aes(x=mes, y=total, group=ano, colour=ano,
text = paste(ano, "-", mes,
"<br>", real(total))))
plt.p1 <- ggplot(totais, aes(x=mes, y=total, group=tipo, colour=tipo,
text = paste(ano, "-", mes,
"<br>", tipo,
"<br>", real(total))))
plt.p1 <- plt.p1 +  geom_line() + geom_point() +
scale_colour_manual(values = getPalette(colourCount))+
facet_grid(ano ~., scale = "free") +
labs(title="Gastos por tipo de despesa - dados não-filtrados",
y="Total (R$)", x="Mês") +
theme(legend.position="bottom") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.p1, tooltip = "text")
colourCount = length(unique(totais$tipo))
getPalette = colorRampPalette(brewer.pal(9, "Set1"))
plt.p1 <- ggplot(totais, aes(x=mes, y=total, group=tipo, colour=tipo,
text = paste(ano, "-", mes,
"<br>", tipo,
"<br>", real(total))))
plt.p1 <- plt.p1 +  geom_line() + geom_point() +
scale_colour_manual(values = getPalette(colourCount))+
facet_grid(ano ~., scale = "free") +
labs(title="Gastos por tipo de despesa - dados não-filtrados",
y="Total (R$)", x="Mês") +
theme(legend.position="bottom") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.p1, tooltip = "text")
sub <- with(dadosT, ano==2015 & mes=="Mar" & tipo=="pagamentos" )
dados <- dadosT[sub,c(1,5:7)]
dados$valor <- real(dados$valor)
View(dados)
kable(dados, caption = "categoria pagamentos, em março de 2015")
sub <- with(dadosT, mes %in% c("Jun","Jul") & day(dadosT$data) == 25)
dadosub <- dadosT[which(sub),]
dadosub$valor <- real(dadosub$valor)
kable(head(dadosub[unique(dadosub$tipo),c(1,5,7)]), caption = "compras no crédito, registradas no dia 25")
kable(tail(dadosub[unique(dadosub$tipo),c(1,5,7)]), caption = "compras no crédito, registradas no dia 25")
dados <- maiores.df.plot[, c(3,1:2)]
dados$media <- real(dados$media)
kable(dados, caption = "Os maiores tipos de despesas")
dados <- m.variacoes[, c(3,1:2)]
m.variacoes <-  maiores %>% group_by(tipo) %>%
summarise(sd = round(sd(media.anual),2)) %>%
arrange(desc(sd)) %>%
mutate(rank = 1:length(sd))
m.variacoes <- subset(m.variacoes, sd > 50)
dados <- m.variacoes[, c(3,1:2)]
dados$sd <- real(dados$sd)
totais <- summarise(dadosT, total.raw=sum(valor)) %>%
mutate(total = real(total.raw))
View(totais)
colourCount = length(unique(totais$tipo))
getPalette = colorRampPalette(brewer.pal(9, "Set1"))
plt.p1 <- ggplot(totais, aes(x=mes, y=total.raw, group=tipo, colour=tipo,
text = paste(ano, "-", mes,
"<br>", tipo,
"<br>", total)))
plt.p1 <- plt.p1 +  geom_line() + geom_point() +
scale_colour_manual(values = getPalette(colourCount))+
facet_grid(ano ~., scale = "free") +
labs(title="Gastos por tipo de despesa - dados não-filtrados",
y="Total (R$)", x="Mês") +
theme(legend.position="bottom") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.p1, tooltip = "text")
arquivos.atual <- dir("../data/")
arquivos.atual <- arquivos.atual[grep("mobills", arquivos.atual)]
dados <- read_excel(paste0("../data/", arquivos.atual[1]), 1,
col_types = c(rep("text",6)))
dados <- tbl_df(dados)
valid_column_names <- make.names(names=names(dados),
unique=TRUE, allow_ = TRUE)
names(dados) <- valid_column_names
names(dados) <- gsub(" ", ".", tolower(names(dados)))
real <- dollar_format(prefix = "R$ ")
dadosT <- dados %>% filter(account == "itau") %>%
rename(tipo = expense.type, valor = amount,
descrição = description) %>%
mutate(data = parse_date_time(date, "dmY"),
descrição = tolower(as.character(descrição)),
tipo = factor(tolower(as.character(tipo))),
valor.raw = as.numeric(gsub("\\$|,","", valor)),
valor = real(valor.raw),
mes = factor(months(data, abbreviate=TRUE),
levels = c("Jan", "Fev", "Mar", "Abr",
"Mai","Jun", "Jul", "Ago",
"Set", "Out","Nov", "Dez"),
ordered=TRUE),
ano = factor(year(data)),
mes.ano = format(data, '%Y-%m')
) %>%
select(data, ano, mes, mes.ano, tipo, descrição, valor)
dadosT <- dados %>% filter(account == "itau") %>%
rename(tipo = expense.type, valor = amount,
descrição = description) %>%
mutate(data = parse_date_time(date, "dmY"),
descrição = tolower(as.character(descrição)),
tipo = factor(tolower(as.character(tipo))),
valor.raw = as.numeric(gsub("\\$|,","", valor)),
valor = real(valor.raw),
mes = factor(months(data, abbreviate=TRUE),
levels = c("Jan", "Fev", "Mar", "Abr",
"Mai","Jun", "Jul", "Ago",
"Set", "Out","Nov", "Dez"),
ordered=TRUE),
ano = factor(year(data)),
mes.ano = format(data, '%Y-%m')
) %>%
select(data, ano, mes, mes.ano, tipo, descrição,
valor.raw,valor)
indices <- grep("previsão", dadosT$descrição)
dadosT <- dadosT[-indices,]
indices <- grep("uber", dadosT$descrição)
dadosT$tipo[indices] <- "transporte"
dadosT <- dadosT %>% group_by(tipo, ano, mes)
save(dadosT, file = "../data/dados-ok.rda")
rm(dados)
View(dadosT)
totais <- summarise(dadosT, total.raw=sum(valor.raw)) %>%
mutate(total = real(total.raw))
View(totais)
View(dadosT)
sub <- with(dadosT, ano==2015 & mes=="Mar" & tipo=="pagamentos" & valor.raw > 4000)
dadosFil <- dadosT[which(!sub),]
dadosFil <- group_by(dadosFil, tipo, ano, mes)
totais <- summarise(dadosFil, total=sum(valor.raw)) %>%
mutate(media = mean(total))
View(totais)
totais <- summarise(dadosFil, total.raw=sum(valor.raw)) %>%
mutate(media.raw = mean(total),
total = real(total.raw),
media = real(media.raw))
totais <- summarise(dadosFil, total.raw=sum(valor.raw)) %>%
mutate(media.raw = mean(total.raw),
total = real(total.raw),
media = real(media.raw))
colourCount = length(unique(totais$tipo))
getPalette = colorRampPalette(brewer.pal(9, "Set1"))
plt.p1 <- ggplot(totais, aes(x=mes, y=total.raw, group=tipo, colour=tipo,
text = paste(ano, "-", mes,
"<br>", tipo,
"<br>", total)))
plt.p1 <- plt.p1 +  geom_line() + geom_point() +
scale_colour_manual(values = getPalette(colourCount))+
facet_grid(ano ~., scale = "free") +
labs(title="Gastos por tipo de despesa - dados não-filtrados",
y="Total (R$)", x="Mês") +
theme(legend.position="bottom") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.p1, tooltip = "text")
sub <- with(dadosT, ano==2015 & mes=="Mar" & tipo=="pagamentos" )
dados <- dadosT[sub,c(1,5,6,8)]
kable(dados, caption = "categoria pagamentos, em março de 2015")
sub <- with(dadosT, mes %in% c("Jun","Jul") & day(dadosT$data) == 25)
dadosub <- dadosT[which(sub),]
kable(head(dadosub[unique(dadosub$tipo),c(1,5,6,8)]), caption = "compras no crédito, registradas no dia 25")
kable(tail(dadosub[unique(dadosub$tipo),c(1,5,6,8)]), caption = "compras no crédito, registradas no dia 25")
sub <- with(dadosT, ano==2015 & mes=="Mar" & tipo=="pagamentos" & valor.raw > 4000)
dadosFil <- dadosT[which(!sub),]
dadosFil <- group_by(dadosFil, tipo, ano, mes)
totais <- summarise(dadosFil, total.raw=sum(valor.raw)) %>%
mutate(media.raw = mean(total.raw),
total = real(total.raw),
media = real(media.raw))
plt.p2 <- ggplot(totais, aes(x=mes, y=total.raw, group=tipo, colour=tipo,
text = paste(ano, "-", mes,
"<br>", tipo,
"<br>", total)))
plt.p2 <- plt.p2 +  geom_line() + geom_point() +
scale_colour_manual(values = getPalette(colourCount))+
facet_grid(ano ~., scale="free") +
labs(title="Gastos por tipo de despesa - dados filtrados",
y="Total (R$)", x="Mês") +
theme(legend.title=element_blank()) +
theme(legend.position="bottom") +
guides(fill=guide_legend(nrow=5, byrow=TRUE)) +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.p2, tooltip = "text")
maiores <- totais %>% group_by(tipo, ano) %>%
summarise(media.anual = round(mean(total.raw),2),
sd.anual=round(sd(total.raw), 2)) %>%
mutate(media.geral = round(mean(media.anual),2),
sd.geral=round(sd(media.anual), 2)) %>%
arrange(desc(media.geral), ano, tipo)
maiores <- subset(maiores, media.geral > 200)
View(maiores)
totais.alim <- totais[totais$tipo=="alimentação",]
medias.alim <- totais.alim %>% group_by(ano) %>%
summarise(media = mean(total.raw))
medias.alim$media <- round(medias.alim$media, 2)
plt.alim <- ggplot(totais.alim, aes(x=mes, y=total, group=ano, colour=ano,
text = paste(ano, "-", mes,
"<br>", real(total))))
View(dadosFil)
View(medias.alim)
View(totais.alim)
totais.alim <- totais[totais$tipo=="alimentação",]
medias.alim <- totais.alim %>% group_by(ano) %>%
summarise(media = mean(total.raw))
medias.alim$media <- round(medias.alim$media, 2)
plt.alim <- ggplot(totais.alim, aes(x=mes, y=total.raw, group=ano, colour=ano,
text = paste(ano, "-", mes,
"<br>", total)))
plt.alim <- plt.alim +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.alim,
aes(yintercept = media, colour = ano,
text=paste(real(media))),
linetype=2) +
# geom_label(data = medias.alim, vjust = -0.2, hjust = 1,
#           aes(12, y = media,label=media)) +
labs(title="Gastos com alimentação", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.alim, tooltip = "text")
sub <- which(dadosFil$ano==2015 & dadosFil$mes %in% c("Jul") &
dadosFil$tipo=="alimentação" & dadosFil$valor.raw > 50)
dados.sel <- dadosFil[sub,]
rank <- order(dados.sel$valor.raw, decreasing = TRUE)
kable(dados.sel[rank,c(1,6,8)], caption = "Gastos em julho de 2015")
totais.moradia <- totais[totais$tipo=="moradia",]
medias.moradia <- totais.moradia %>% group_by(ano) %>%
summarise(media = mean(total.raw))
medias.moradia$media <- round(medias.moradia$media, 2)
plt.moradia <- ggplot(totais.moradia,
aes(x=mes, y=total.raw,group=ano, colour=ano,
text = paste(ano, "-", mes,
"<br>", total)))
plt.moradia <- plt.moradia +  geom_line() +
geom_point(size=1, alpha=0.5) +
geom_hline(data = medias.moradia,
aes(yintercept = media, colour = ano,
text=paste(real(media))),
linetype=2) +
# geom_label(data = medias.moradia, vjust = -0.2, hjust = 1,
#           aes(12, y = media,label=media)) +
labs(title="Gastos com moradia", y="Total (R$)", x="Mês") +
theme(plot.title = element_text(hjust = 0.5))
ggplotly(plt.moradia, tooltip = "text")
unlink('~/Documents/dataS-anotacoes/mobils/index_cache', recursive = TRUE)
